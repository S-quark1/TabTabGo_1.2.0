(function(){let s=null;function i(e){const n=Math.floor(e/1e3),t=Math.floor(n/60),a=n%60;return`${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}async function o(){const e=await chrome.storage.local.get(["sessionActive","currentSession","currentTask"]);e.sessionActive&&e.currentSession?(document.getElementById("session-setup").style.display="none",document.getElementById("session-active").style.display="block",document.getElementById("session-user-id").textContent=e.currentSession.participantId,document.getElementById("session-mode").textContent=e.currentSession.mode==="trackpad"?"Trackpad":"TabTabGo",document.getElementById("session-interactions").textContent=e.currentSession.totalInteractions||0,e.currentTask?(document.getElementById("task-info-title").textContent=`ðŸ“‹ Current Task: ${e.currentTask.taskId}`,document.getElementById("current-task-info").style.display="block",document.getElementById("current-task-number").textContent=`Task ${(e.currentSession.tasks?.length||0)+1} of ${e.currentSession.totalTasks}`):document.getElementById("current-task-info").style.display="none",d(e.currentSession.sessionStartTs)):(document.getElementById("session-setup").style.display="block",document.getElementById("session-active").style.display="none",s&&(clearInterval(s),s=null))}function d(e){s&&clearInterval(s),s=setInterval(async()=>{const n=Date.now()-e;document.getElementById("session-duration").textContent=i(n);const t=await chrome.storage.local.get(["currentSession","currentTask"]);t.currentSession&&(document.getElementById("session-interactions").textContent=t.currentSession.totalInteractions||0,t.currentTask&&(document.getElementById("task-info-title").textContent=`ðŸ“‹ Current Task: ${t.currentTask.taskId}`,document.getElementById("current-task-info").style.display="block",document.getElementById("current-task-number").textContent=`Task ${(t.currentSession.tasks?.length||0)+1} of ${t.currentSession.totalTasks}`))},1e3)}document.getElementById("start-session-btn").addEventListener("click",async()=>{const e=document.getElementById("participant-id-input").value.trim(),n=document.getElementById("session-id-input").value.trim(),t=document.getElementById("mode-select").value;if(e)try{(await chrome.runtime.sendMessage({action:"startSession",participantId:e,sessionId:n,mode:t})).success&&await o()}catch(a){console.error("Error starting session:",a)}}),document.getElementById("complete-task-btn").addEventListener("click",async()=>{try{(await chrome.runtime.sendMessage({action:"completeTask",endState:"completed"})).success&&await o()}catch(e){console.error("Error completing task:",e)}}),document.getElementById("skip-task-btn").addEventListener("click",async()=>{try{(await chrome.runtime.sendMessage({action:"completeTask",endState:"skipped"})).success&&await o()}catch(e){console.error("Error skipping task:",e)}});const l=document.getElementById("howto-btn"),c=document.getElementById("howto-modal"),m=document.getElementById("modal-close-btn");l.addEventListener("click",()=>{c.classList.add("show")}),m.addEventListener("click",()=>{c.classList.remove("show")}),c.addEventListener("click",e=>{e.target===c&&c.classList.remove("show")});const u=document.getElementById("cite-btn"),r=document.getElementById("cite-modal"),y=document.getElementById("cite-modal-close-btn");u.addEventListener("click",()=>{r.classList.add("show")}),y.addEventListener("click",()=>{r.classList.remove("show")}),r.addEventListener("click",e=>{e.target===r&&r.classList.remove("show")}),o(),chrome.storage.onChanged.addListener((e,n)=>{n==="local"&&o()})})();
